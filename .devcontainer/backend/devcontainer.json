{
  // DevContainer 名（VS Code 左下の接続先表示）
  "name": "entra-poc-backend",
  // リポジトリ直下の docker-compose.yml を参照（backend/devcontainer.json から 2階層上）
  "dockerComposeFile": [
    "../../docker-compose.yml"
  ],
  // compose の service 名
  "service": "backend",
  // この DevContainer を開いたときのワークスペース
  "workspaceFolder": "/workspace/backend",
  /**
   * ✅ この DevContainer が起動するサービスを固定
   * - backend を開いたら backend + db だけを up する
   * - frontend 側 DevContainer を開いた時に backend が巻き込まれて recreate されにくくなる
   */
  "runServices": [
    "backend",
    "db"
  ],
  /**
   * ✅ ウィンドウを閉じても compose を止めない
   * - 片方の DevContainer を閉じた時に、もう片方まで落ちる事故を防ぐ
   */
  "shutdownAction": "none",
  // ✅ 開発者ごとの UID/GID 差を吸収（bind mount の権限事故を防ぐ）
  "remoteUser": "vscode",
  "updateRemoteUserUID": true,
  // backend を開いた後に実行（Rust 依存取得など）
  "postCreateCommand": "cargo fetch",
  // VS Code 側のカスタマイズ設定
  "customizations": {
    "vscode": {
      "extensions": [
        "rust-lang.rust-analyzer",
        "vadimcn.vscode-lldb",
        "tamasfe.even-better-toml",
        "ms-azuretools.vscode-docker"
      ],
      "settings": {
        // ✅ /workspace/backend を開いていても /workspace/.git を拾う
        "git.openRepositoryInParentFolders": "always",
        // ✅ target/node_modules/.git の監視を除外（WSL + bind mount で重くなる対策）
        "files.watcherExclude": {
          "**/target/**": true,
          "**/node_modules/**": true,
          "**/.git/**": true
        },
        // ✅ 検索対象からも除外
        "search.exclude": {
          "**/target/**": true,
          "**/node_modules/**": true
        },
        // 任意：rust-analyzer のワークスペース探索
        "rust-analyzer.cargo.workspaceDiscovery": true
      }
    }
  },
  // ホスト(WSL)の ssh-agent ソケットをコンテナに渡す
  "mounts": [
    "type=bind,source=${localEnv:SSH_AUTH_SOCK},target=/ssh-agent"
  ],
  "remoteEnv": {
    "SSH_AUTH_SOCK": "/ssh-agent"
  },
  // backend 側でよく使うポートだけ forward
  "forwardPorts": [
    8080,
    5432
  ]
}